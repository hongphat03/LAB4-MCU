/*
 * fsm_modify.c
 *
 *  Created on: Dec 3, 2022
 *      Author: Hong Phat
 */


#include "fsm_modify.h"

void fsm_modify_run(){
	switch(status){
	case MODIFY_RED:
		HAL_GPIO_WritePin(GPIOA,GPIO_PIN_3,0);
		HAL_GPIO_WritePin(GPIOA,GPIO_PIN_10,0);
		HAL_GPIO_WritePin(GPIOA,GPIO_PIN_4,1);
		HAL_GPIO_WritePin(GPIOA,GPIO_PIN_5,1);
		HAL_GPIO_WritePin(GPIOA,GPIO_PIN_11,1);
		HAL_GPIO_WritePin(GPIOA,GPIO_PIN_12,1);
		if(isButton1Pressed() == 1){
			// if button is pressed, mode is changed to mode 3 ( modify time for yellow led)
			timer_red = set_timer*1000;
			status = AUTO_RED;
			status2 = AUTO_RED;
		}
		if(isButton3Pressed() == 1){
			// if button2 is pressed, value of timer duration increase one second
			set_timer++;
			if(set_timer > 99) set_timer = 1;
		}
		if(isButton2Pressed() == 1){
			// if button3 is pressed, set the value
			timer_red = set_timer*1000;
			status = MODIFY_GREEN;
			status2 = MODIFY_GREEN;
		}
		break;
	case MODIFY_YELLOW:
		HAL_GPIO_WritePin(GPIOA,GPIO_PIN_4,0);
		HAL_GPIO_WritePin(GPIOA,GPIO_PIN_11,0);
		HAL_GPIO_WritePin(GPIOA,GPIO_PIN_3,1);
		HAL_GPIO_WritePin(GPIOA,GPIO_PIN_5,1);
		HAL_GPIO_WritePin(GPIOA,GPIO_PIN_10,1);
		HAL_GPIO_WritePin(GPIOA,GPIO_PIN_12,1);
		if(isButton1Pressed() == 1){
			// if button is pressed, mode is changed to mode 3 ( modify time for yellow led)
			timer_yellow = set_timer*1000;
			set_timer = 0;
			status = AUTO_RED;
			status2 = AUTO_RED;
		}
		if(isButton3Pressed() == 1){
			// if button2 is pressed, value of timer duration increase one second
			set_timer++;
			if(set_timer > 99) set_timer = 1;
		}
		if(isButton2Pressed() == 1){
			// if button3 is pressed, set the value
			timer_red = set_timer*1000;
			set_timer = 0;
			status = MODIFY_RED;
			status2 = MODIFY_RED;
		}
			break;
	case MODIFY_GREEN:
		HAL_GPIO_WritePin(GPIOA,GPIO_PIN_5,0);
		HAL_GPIO_WritePin(GPIOA,GPIO_PIN_12,0);
		HAL_GPIO_WritePin(GPIOA,GPIO_PIN_3,1);
		HAL_GPIO_WritePin(GPIOA,GPIO_PIN_4,1);
		HAL_GPIO_WritePin(GPIOA,GPIO_PIN_10,1);
		HAL_GPIO_WritePin(GPIOA,GPIO_PIN_11,1);
		if(isButton1Pressed() == 1){
			// if button is pressed, mode is changed to mode 3 ( modify time for yellow led)
			timer_green = set_timer*1000;
			set_timer = 0;
			status = AUTO_RED;
			status2 = AUTO_RED;
		}
		if(isButton3Pressed() == 1){
			// if button2 is pressed, value of timer duration increase one second
			set_timer++;
			if(set_timer > 99) set_timer = 1;
		}
		if(isButton2Pressed() == 1){
			// if button3 is pressed, set the value
			timer_green = set_timer*1000;
			set_timer = 0;
			status = MODIFY_YELLOW;
			status2 = MODIFY_YELLOW;
		}
		break;
	default:
		break;
	}
}
